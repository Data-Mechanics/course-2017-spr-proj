import flask
import method2
import json
from flask import Flask, Response, request, render_template, redirect, url_for, make_response, jsonify, abort, Blueprint
from http.server import BaseHTTPRequestHandler, HTTPServer
import datetime
import dml


app = Flask(__name__)


@app.route('/1.html', methods=['GET'])
def show_client1():
	return open('1.html','r').read()

@app.route('/1_files/leaflet.css', methods=['GET'])
def show_client2():
	return Response(open('1_files/leaflet.css','r').read(), mimetype='text/css')

@app.route('/1_files/leaflet.js', methods=['GET'])
def show_client3():
	return open('1_files/leaflet.js','r').read()

@app.route('/1_files/togeojson.js', methods=['GET'])
def show_client4():
	return open('1_files/togeojson.js','r').read()

@app.route('/1_files/leaflet.filelayer.js', methods=['GET'])
def show_client5():
	return open('1_files/leaflet.filelayer.js','r').read()

@app.route('/1_files/Edit.Rectangle.js', methods=['GET'])
def show_client6():
	return open('1_files/Edit.Rectangle.js','r').read()

@app.route('/1_files/FunctionButton.js', methods=['GET'])
def show_client7():
	return open('1_files/FunctionButton.js','r').read()

@app.route('/jquery-3.2.1.min.js', methods=['GET'])
def show_client8():
	return open('jquery-3.2.1.min.js','r').read()

@app.route('/1_files/Edit.SimpleShape.js', methods=['GET'])
def show_client9():
	return open('1_files/Edit.SimpleShape.js','r').read()


@app.route('/req', methods=['POST'])
def create_user():
	startTime = datetime.datetime.now()

	# Set up the database connection.
	client = dml.pymongo.MongoClient()
	repo = client.repo
	repo.authenticate('cici_fyl', 'cici_fyl')

	propertydata = repo['cici_fyl.property'].find()
	schoolcoordinates=[[42.38879868072768, -71.00412057470655], [42.37854529844325, -71.03048029257982], [42.37527867719902, -71.03389058362008], [42.37808861764244, -71.03801071795255], [42.3809574570732, -71.03492143398994], [42.378289993174945, -71.04032982414778], [42.36967602260976, -71.03411994961286], [42.36927367623504, -71.03430758289728], [42.365563004886006, -71.03489031049398], [42.376628517458556, -71.05749224511395], [42.38011867733693, -71.06107059296349], [42.37908035586216, -71.06723124431771], [42.377998676181065, -71.06443059329952], [42.36610274141337, -71.0533696697166], [42.348408293612316, -71.06905024614143], [42.34797867069197, -71.06492059178068], [42.35057867102015, -71.07797059619475], [42.34436866974638, -71.07352059425547], [42.34436866974638, -71.07352059425547], [42.33875866890724, -71.07774059556849], [42.34073755178531, -71.0724610665085], [42.32621703137864, -71.07133140548119], [42.32317619519667, -71.05819134475853], [42.33131866821851, -71.05054058634448], [42.33286866892035, -71.04489058467883], [42.33487070736289, -71.0384112843871], [42.33212076905114, -71.03019874424272], [42.32038241146029, -71.0595494081695], [42.330275209870514, -71.07790901904482], [42.282268654593295, -71.17434062433898], [42.33357372154742, -71.05042965649886], [42.32702866632698, -71.08171059661103], [42.340559774224396, -71.08383997543653], [42.331758667019805, -71.09029059941818], [42.33203866686597, -71.08879259924534], [42.3303986664829, -71.09097059953756], [42.32554866590045, -71.09104059893866], [42.32094834333561, -71.08630956644335], [42.314966854420746, -71.07893912859326], [42.31574003450813, -71.08784105464046], [42.316158664082955, -71.08450059695633], [42.3163342994336, -71.09289159498273], [42.31820265054459, -71.07562660054356], [42.31129966334802, -71.07619659334921], [42.309054022750715, -71.07541082460732], [42.30561812926608, -71.07385901878241], [42.3083962123703, -71.06101177184591], [42.29992614674246, -71.07072943158303], [42.293966727170606, -71.06222064376846], [42.29420617682231, -71.04919405898903], [42.28655025040385, -71.05319153707637], [42.28126172755286, -71.06956992654236], [42.27786074668804, -71.07743056565947], [42.28141865783004, -71.0809105936998], [42.28141865783004, -71.0809105936998], [42.2767606568668, -71.09042959653883], [42.28779215410131, -71.07679145463584], [42.29243810495752, -71.08037541961784], [42.28660892668269, -71.0730086271986], [42.2967884983735, -71.0756002591556], [42.282314660302255, -71.09500233394891], [42.27581530957716, -71.10408944277009], [42.26725865453182, -71.1047806003227], [42.301128790627615, -71.06172942103164], [42.285408657026494, -71.1177406058554], [42.28675865774214, -71.10772060214966], [42.29463865890977, -71.1159406055389], [42.24295075932907, -71.12345116642209], [42.251628650547204, -71.13332060866864], [42.25676865119825, -71.12732060741166], [42.27479865484343, -71.12705060845161], [42.283638656688304, -71.12493060765705], [42.28645865765351, -71.12684060843038], [42.308928662468276, -71.10349060219235], [42.31393788372544, -71.09812020670003], [42.30600866103998, -71.10960060422627], [42.3165586640321, -71.10161060258602], [42.321785326976965, -71.10583938261135], [42.3262927571696, -71.10693577133999], [42.333018666957756, -71.09829060230336], [42.33789866792788, -71.1016906039024], [42.34145866846504, -71.09153060016702], [42.33058827746703, -71.09917802070898], [42.346772613595334, -71.09432127991825], [42.34343866904441, -71.09926060292185], [42.34794866976965, -71.1067606061076], [42.31868547674178, -71.11421891268786], [42.318508664013486, -71.11295060572958], [42.30558866071171, -71.13149061131938], [42.27776865530498, -71.13533061089309], [42.28122865613063, -71.1410506131549], [42.29266065748693, -71.15236761751912], [42.263438651513844, -71.15613061695596], [42.27188581950671, -71.16257012581823], [42.282268654593295, -71.17434062433898], [42.28299865562324, -71.1583706186444], [42.34558866764172, -71.16019062322468], [42.35107866816018, -71.16150062402028], [42.35212866822168, -71.16076062399442], [42.347601703400365, -71.15534859955117], [42.26526119203469, -71.11792785463243], [42.34908866824283, -71.14549061813761], [42.34203866764442, -71.14051061675723], [42.352058669309685, -71.13770061636266], [42.352058669309685, -71.13770061636266], [42.26321706364385, -71.11772383064972], [42.36076867149947, -71.13411061572548], [42.260758651727734, -71.14961061446101], [42.31368761201168, -71.05976976006767], [42.282120944652796, -71.08684032525326], [42.29656011318188, -71.08066201707948], [42.3068187606906, -71.08162523596036], [42.31762866595024, -71.04274058288499], [42.31802866555888, -71.04350058306014], [42.338025893716036, -71.05215122145272], [42.233898647412765, -71.13288060787326], [42.39161617989621, -71.00504507541834], [42.32562212282472, -71.10691068997163], [42.27178865514667, -71.09189059664185], [42.314128663116044, -71.09929060181092], [42.30703515349671, -71.11386744117334], [42.307208293048205, -71.11448218494337], [42.32192747288896, -71.0733736622811], [42.3339314261802, -71.1065636650741], [42.26322789700843, -71.11788606540483], [42.36833522594887, -71.05717617021216], [42.31766018904394, -71.09202957064066], [42.37156843642837, -71.0379400823357], [42.34876971019516, -71.06814953565042], [42.30082133096725, -71.06182116205184], [42.350440725035895, -71.14596105824006], [42.3073951680894, -71.08080770579843]]
	restaurantcoordinates=[[42.275977, -71.139161], [42.272239, -71.068856], [42.280288, -71.158001], [42.35724, -71.070269], [42.36102, -71.06319], [42.34936, -71.08253], [42.25459, -71.12019], [42.349893, -71.057819], [42.375917, -71.039339], [42.35082, -71.07887], [42.351057, -71.060789], [42.38451, -71.07193], [42.30583, -71.10785], [42.350178, -71.06061], [42.28746, -71.15016], [42.333796, -71.104562], [42.301184, -71.059748], [42.268244, -71.093378], [42.356532, -71.050251], [42.379899, -71.026814], [42.329364, -71.084435], [42.35757, -71.05385], [42.343257, -71.072509], [42.349593, -71.080258], [42.361495, -71.056409], [42.35876, -71.0562], [42.363585, -71.054861], [42.34682, -71.07543], [42.357552, -71.058461], [42.346689, -71.089011], [42.30224, -71.06], [42.32146, -71.06264], [42.333793, -71.105138], [42.371665, -71.042087], [42.361814, -71.06131], [42.33982, -71.10568], [42.3091, -71.10514], [42.35098, -71.06046], [42.310802, -71.114458], [42.375806, -71.038929], [42.346932, -71.08797], [42.268249, -71.093011], [42.35875, -71.056199], [42.335135, -71.035629], [42.357719, -71.05907], [42.35058, -71.06029], [42.35111, -71.0502], [42.364967, -71.053051], [42.283328, -71.089341], [42.335436, -71.035227], [42.351592, -71.131415], [42.324073, -71.10315], [42.34612, -71.09929], [42.35654, -71.13923], [42.24246, -71.127331], [42.33208, -71.07102], [42.35701, -71.05761], [42.346723, -71.09868], [42.351231, -71.050594], [42.2788, -71.11601], [42.363881, -71.062398], [42.32656, -71.06169], [42.359232, -71.05532], [42.311378, -71.114669], [42.351393, -71.062629], [42.35031, -71.0571], [42.3524, -71.12881], [42.35044, -71.16784], [42.299952, -71.058533], [42.364038, -71.054008], [42.366649, -71.119992], [42.285411, -71.128978], [42.357648, -71.058776], [42.34978, -71.08272], [42.3712, -71.061707], [42.35084, -71.07311], [42.351377, -71.065481], [42.28895, -71.13389], [42.283811, -71.07134], [42.27299, -71.06805], [42.35003, -71.08169], [42.362108, -71.065981], [42.308248, -71.088946], [42.287186, -71.152539], [42.356135, -71.054068], [42.364494, -71.061192], [42.312748, -71.113869], [42.3508, -71.06052], [42.33721, -71.04375], [42.351401, -71.05752], [42.344147, -71.098428], [42.32487, -71.07551], [42.346723, -71.09868], [42.302878, -71.085018], [42.352564, -71.130408], [42.351263, -71.064339], [42.36012, -71.05091], [42.345792, -71.069134], [42.360929, -71.069218], [42.261598, -71.15733], [42.314637, -71.104489], [42.36012, -71.05091], [42.34258, -71.09953], [42.357144, -71.060857], [42.364307, -71.059631], [42.351249, -71.06068], [42.33542, -71.037], [42.35768, -71.05376], [42.30443, -71.05945], [42.34213, -71.07565], [42.379379, -71.027994], [42.25558, -71.12118], [42.36012, -71.05091], [42.3493, -71.09619], [42.315564, -71.104269], [42.31437, -71.06585], [42.279782, -71.09262], [42.285528, -71.090708], [42.36195, -71.14221], [42.351776, -71.12426], [42.352901, -71.132751], [42.351362, -71.06874], [42.355594, -71.074207], [42.34846, -71.08534], [42.32863, -71.08105], [42.348135, -71.080855], [42.354049, -71.055925], [42.35316, -71.13166], [42.344649, -71.102201], [42.351362, -71.06874], [42.352383, -71.1253], [42.3435, -71.0648], [42.357037, -71.06017], [42.37348, -71.03925], [42.34896, -71.153749], [42.35744, -71.05316], [42.359519, -71.063449], [42.341708, -71.080787], [42.34982, -71.13342], [42.365678, -71.066648], [42.35316, -71.13166], [42.350167, -71.14462], [42.34914, -71.08335], [42.35112, -71.07758], [42.29957, -71.07367], [42.313144, -71.038947], [42.352761, -71.131849], [42.35745, -71.0607], [42.33227, -71.074], [42.28231, -71.05511], [42.33201, -71.08248], [42.35185, -71.08681], [42.253729, -71.12432], [42.348492, -71.096725], [42.291672, -71.046857], [42.34226, -71.07527], [42.337039, -71.047689], [42.365578, -71.052718], [42.311257, -71.058111], [42.350021, -71.055941], [42.33982, -71.10568], [42.34493, -71.082807], [42.308104, -71.058789], [42.345668, -71.05112], [42.349137, -71.084995], [42.35283, -71.0716], [42.35091, -71.06207], [42.347082, -71.078373], [42.35415, -71.13658], [42.35006, -71.072919], [42.330416, -71.066709], [42.35053, -71.0739], [42.336824, -71.151471], [42.353848, -71.058561], [42.286425, -71.136969], [42.304101, -71.114452], [42.350032, -71.065531], [42.350776, -71.066229], [42.350776, -71.066229], [42.352411, -71.125329], [42.351826, -71.0699], [42.33508, -71.05729], [42.349511, -71.16376], [42.37134, -71.060913], [42.35112, -71.07758], [42.278703, -71.118942], [42.333711, -71.105368], [42.341227, -71.146549], [42.353624, -71.132412], [42.347296, -71.081457], [42.366875, -71.020905], [42.350881, -71.127591], [42.360955, -71.065859], [42.301927, -71.060226], [42.344764, -71.09583], [42.353511, -71.056728], [42.27859, -71.11944], [42.369371, -71.040322], [42.364427, -71.055371], [42.285377, -71.155777], [42.33152, -71.07035], [42.352856, -71.043074], [42.346723, -71.09868], [42.346723, -71.09868], [42.3581, -71.07068], [42.3466, -71.14185], [42.346723, -71.09868], [42.38254, -71.0792], [42.27646, -71.16677], [42.386578, -71.009157], [42.357643, -71.053639], [42.351717, -71.13146], [42.351378, -71.065729], [42.27723, -71.15163], [42.34261, -71.084169], [42.341274, -71.087336], [42.34993, -71.04741], [42.29929, -71.06025], [42.334515, -71.074014], [42.34855, -71.09348], [42.357563, -71.058423], [42.350703, -71.076174], [42.340178, -71.090231], [42.255266, -71.1245], [42.35107, -71.06308], [42.35107, -71.057119], [42.342178, -71.08624], [42.3581, -71.06184], [42.38129, -71.061549], [42.357122, -71.060928], [42.36058, -71.071306], [42.375177, -71.0386], [42.36488, -71.05315], [42.30569, -71.06733], [42.303207, -71.084901], [42.30008, -71.05995], [42.268881, -71.093351], [42.352846, -71.132618], [42.349008, -71.142658], [42.350021, -71.055941], [42.313144, -71.038947], [42.37017, -71.03868], [42.350779, -71.058449], [42.287818, -71.126399], [42.37445, -71.04028], [42.363196, -71.056279], [42.32843, -71.08311], [42.266054, -71.12084], [42.30628, -71.10743], [42.348407, -71.078649], [42.35037, -71.08902], [42.351362, -71.06874], [42.32969, -71.05287], [42.356217, -71.061937], [42.353895, -71.048576], [42.28358, -71.15676], [42.359035, -71.054823], [42.35859, -71.07049], [42.28521, -71.09331], [42.35583, -71.0604], [42.351362, -71.06874], [42.351661, -71.060969], [42.318042, -71.066978], [42.342989, -71.045087], [42.34413, -71.07777], [42.31214, -71.11395], [42.35141, -71.06013], [42.335689, -71.046301], [42.28588, -71.15506], [42.346723, -71.09868], [42.36783, -71.06495], [42.35474, -71.05384], [42.37014, -71.03916], [42.346723, -71.09868], [42.34012, -71.05676], [42.34533, -71.10015], [42.34918, -71.08319], [42.347296, -71.081457], [42.364196, -71.059521], [42.338284, -71.106989], [42.35081, -71.07581], [42.320061, -71.056929], [42.34156, -71.07662], [42.31006, -71.11548], [42.357406, -71.069855], [42.336455, -71.149569], [42.34924, -71.07244], [42.34304, -71.06941], [42.347281, -71.070818], [42.261873, -71.15741], [42.352467, -71.056269], [42.386166, -71.00953], [42.35969, -71.06179], [42.273398, -71.067948], [42.319061, -71.056494], [42.295415, -71.048888], [42.348192, -71.03913], [42.34677, -71.088788], [42.339219, -71.050958], [42.35463, -71.150488], [42.351624, -71.061017], [42.286098, -71.129018], [42.351311, -71.06264], [42.28779, -71.07781], [42.292072, -71.071521], [42.3541, -71.05228], [42.290394, -71.07187], [42.36185, -71.06661], [42.348329, -71.075011], [42.348701, -71.081632], [42.32975, -71.05739], [42.285777, -71.09125], [42.348878, -71.152342], [42.38998, -71.005509], [42.35192, -71.05795], [42.35356, -71.05736], [42.36888, -71.039276], [42.35878, -71.06183], [42.379336, -71.02807], [42.33474, -71.07567], [42.318959, -71.077569], [42.346828, -71.08857], [42.34924, -71.07244], [42.353081, -71.130624], [42.343564, -71.072012], [42.32274, -71.10644], [42.341632, -71.08698], [42.326543, -71.065176], [42.348814, -71.099357], [42.356834, -71.07005], [42.350167, -71.079588], [42.351466, -71.060209], [42.364539, -71.021817], [42.35806, -71.06972], [42.351757, -71.064491], [42.370207, -71.039361], [42.29201, -71.12244], [42.35629, -71.06185], [42.36561, -71.05597], [42.350406, -71.059976], [42.35668, -71.05257], [42.344449, -71.044821], [42.280014, -71.158191], [42.364227, -71.032549], [42.312887, -71.114449], [42.352225, -71.064909], [42.336249, -71.166434], [42.36455, -71.05571], [42.336106, -71.10748], [42.36316, -71.05631], [42.356891, -71.057958], [42.359198, -71.027191], [42.339878, -71.07261], [42.360028, -71.056245], [42.346865, -71.080632], [42.368982, -71.039212], [42.35137, -71.06236], [42.35426, -71.0566], [42.352916, -71.12052], [42.349248, -71.061208], [42.36476, -71.060746], [42.360947, -71.064886], [42.36535, -71.0532], [42.358456, -71.057646], [42.348545, -71.077314], [42.31686, -71.11327], [42.329343, -71.095804], [42.344074, -71.077812], [42.38599, -71.00526], [42.342036, -71.086429], [42.379626, -71.026928], [42.315736, -71.065951], [42.35922, -71.06557], [42.3577, -71.05896], [42.272382, -71.067789], [42.286485, -71.129958], [42.345875, -71.064496], [42.347296, -71.081457], [42.34874, -71.083445], [42.32199, -71.10926], [42.333842, -71.103341], [42.282376, -71.047658], [42.315432, -71.06626], [42.34921, -71.07513], [42.351311, -71.06182], [42.268453, -71.094131], [42.338006, -71.03568], [42.33331, -71.10601], [42.28641, -71.13043], [42.30036, -71.11297], [42.37902, -71.03989], [42.26287, -71.10831], [42.350021, -71.055941], [42.351109, -71.07458], [42.373526, -71.066473], [42.34682, -71.07543], [42.26841, -71.13288], [42.332783, -71.083221], [42.342794, -71.066726], [42.37608, -71.0361], [42.312503, -71.11437], [42.356944, -71.050388], [42.337549, -71.084074], [42.35845, -71.06084], [42.3642, -71.05382], [42.310892, -71.11438], [42.322272, -71.060848], [42.37749, -71.06668], [42.35927, -71.05643], [42.346725, -71.069653], [42.36335, -71.05584], [42.348815, -71.151268], [42.306223, -71.107469], [42.346779, -71.0761], [42.30064, -71.1127], [42.352411, -71.125329], [42.3464, -71.08902], [42.341247, -71.146504], [42.36066, -71.056626], [42.35443, -71.06218], [42.34753, -71.08411], [42.32815, -71.060075], [42.350021, -71.055941], [42.313144, -71.038947], [42.37861, -71.02936], [42.31124, -71.11473], [42.30053, -71.112809], [42.353869, -71.13572], [42.335603, -71.045528], [42.350682, -71.070358], [42.27724, -71.17261], [42.313161, -71.074241], [42.35798, -71.05599], [42.3334, -71.10305], [42.35307, -71.06292], [42.33608, -71.04702], [42.29105, -71.06302], [42.352411, -71.125329], [42.30992, -71.09152], [42.344744, -71.098289], [42.329935, -71.056761], [42.336249, -71.166434], [42.339769, -71.103259], [42.364326, -71.053705], [42.283597, -71.050828], [42.360005, -71.051226], [42.29298, -71.07162], [42.35744, -71.05316], [42.237865, -71.131859], [42.278345, -71.137197], [42.362858, -71.055056], [42.350078, -71.063059], [42.34175, -71.106442], [42.286122, -71.136731], [42.34233, -71.07514], [42.343759, -71.062729], [42.34938, -71.084014], [42.363408, -71.025698], [42.353081, -71.130624], [42.337287, -71.04805], [42.34738, -71.07484], [42.346828, -71.08857], [42.35121, -71.06037], [42.348617, -71.083619], [42.353088, -71.131119], [42.360985, -71.06661], [42.35084, -71.07311], [42.354147, -71.057948], [42.355042, -71.059128], [42.336249, -71.166434], [42.34921, -71.07513], [42.351297, -71.069204], [42.36503, -71.05348], [42.3524, -71.12881], [42.347411, -71.094422], [42.349278, -71.079625], [42.382498, -71.018149], [42.293557, -71.061944], [42.336106, -71.10748], [42.322376, -71.109129], [42.349571, -71.095239], [42.37654, -71.065421], [42.315997, -71.049211], [42.353254, -71.061258], [42.36403, -71.12407], [42.36203, -71.070362], [42.349217, -71.081684], [42.35091, -71.07152], [42.32267, -71.10675], [42.35344, -71.05904], [42.346723, -71.09868], [42.35315, -71.06403], [42.326302, -71.065271], [42.25246, -71.11896], [42.36536, -71.05793], [42.35194, -71.11926], [42.36711, -71.03607], [42.344699, -71.071387], [42.351377, -71.065481], [42.32199, -71.10926], [42.340338, -71.109399], [42.309531, -71.057693], [42.352823, -71.046098], [42.283445, -71.091398], [42.377727, -71.067013], [42.35129, -71.0646], [42.37369, -71.038873], [42.34854, -71.09385], [42.35101, -71.06162], [42.35342, -71.138458], [42.365582, -71.058131], [42.2866, -71.13017], [42.36471, -71.06196], [42.350769, -71.060935], [42.331401, -71.095959], [42.372572, -71.061056], [42.33791, -71.07465], [42.363199, -71.055433], [42.3044, -71.058961], [42.34966, -71.08314], [42.346723, -71.09868], [42.352886, -71.058695], [42.35402, -71.05813], [42.352008, -71.059912], [42.36203, -71.070362], [42.346723, -71.09868], [42.35583, -71.0604], [42.3492, -71.08312], [42.350505, -71.089578], [42.36312, -71.1333], [42.33666, -71.08563], [42.340294, -71.166405], [42.3552, -71.06239], [42.366963, -71.05818], [42.376526, -71.033798], [42.386166, -71.00953], [42.34846, -71.08432], [42.346723, -71.09868], [42.353081, -71.130624], [42.359387, -71.054174], [42.343689, -71.086548], [42.34657, -71.08384], [42.38717, -71.0086], [42.355179, -71.053595], [42.35838, -71.07042], [42.344315, -71.143025], [42.355037, -71.05402], [42.35525, -71.07414], [42.271418, -71.073999], [42.309398, -71.08204], [42.364131, -71.061074], [42.34967, -71.13011], [42.332278, -71.100023], [42.29413, -71.13674], [42.34682, -71.07543], [42.303295, -71.078779], [42.343077, -71.09911], [42.34966, -71.08314], [42.34886, -71.0844], [42.351506, -71.064544], [42.356984, -71.053548], [42.308431, -71.058031], [42.322657, -71.108212], [42.346723, -71.09868], [42.350514, -71.050275], [42.349586, -71.047643], [42.311843, -71.114001], [42.341323, -71.084481], [42.339072, -71.108098], [42.353821, -71.137278], [42.34975, -71.08108], [42.308431, -71.058031], [42.370435, -71.031732], [42.348579, -71.07304], [42.287192, -71.152571], [42.33927, -71.09405], [42.37853, -71.035], [42.341552, -71.154278], [42.34659, -71.07051], [42.28564, -71.12926], [42.355486, -71.130715], [42.347296, -71.081457], [42.351219, -71.064646], [42.360691, -71.056346], [42.336202, -71.072487], [42.346723, -71.09868], [42.357778, -71.060109], [42.354245, -71.05484], [42.353767, -71.137459], [42.35191, -71.11889], [42.34094, -71.08811], [42.333487, -71.105724], [42.33724, -71.10217], [42.353733, -71.058509], [42.356847, -71.070066], [42.354326, -71.132221], [42.353458, -71.062852], [42.357708, -71.05628], [42.33566, -71.07446], [42.344797, -71.089441], [42.35811, -71.05933], [42.3438, -71.06631], [42.35769, -71.05302], [42.34645, -71.08526], [42.350319, -71.131871], [42.364531, -71.055371], [42.278028, -71.066046], [42.35006, -71.072919], [42.352266, -71.066497], [42.346723, -71.09868], [42.351395, -71.053852], [42.344449, -71.044821], [42.346999, -71.087817], [42.334987, -71.089493], [42.358974, -71.054235], [42.35635, -71.051804], [42.30074, -71.05978], [42.344449, -71.044821], [42.35583, -71.0604], [42.36451, -71.06171], [42.30136, -71.067739], [42.352294, -71.140439], [42.350032, -71.065531], [42.28702, -71.12948], [42.306157, -71.059048], [42.357884, -71.058215], [42.348617, -71.085334], [42.331462, -71.112153], [42.346723, -71.09868], [42.353633, -71.057366], [42.362202, -71.068988], [42.348611, -71.074438], [42.35359, -71.13892], [42.31159, -71.11461], [42.35031, -71.079], [42.374597, -71.038799], [42.348363, -71.097697], [42.32103, -71.06171], [42.364533, -71.061391], [42.373853, -71.038885], [42.336249, -71.166434], [42.331251, -71.041281], [42.264402, -71.16782], [42.355646, -71.062559], [42.2828, -71.1131], [42.37985, -71.02658], [42.363692, -71.05591], [42.33546, -71.04601], [42.356286, -71.0575], [42.349958, -71.130478], [42.32087, -71.06091], [42.33901, -71.104249]]

	d= request.json
	x=[]
	y=[]

	for i in d:
		x.append(i["point"][0])
		y.append(i["point"][1])
	smallx=min(x)
	bigx=max(x)
	smally=min(y)
	bigy=max(y)


	schoolcoordinates= inrange(smallx,bigx,smally,bigy,schoolcoordinates)
	restaurantcoordinates= inrange(smallx,bigx,smally,bigy,restaurantcoordinates)

	coordinates= method2.union(schoolcoordinates,restaurantcoordinates)
	coordinates= method2.project(coordinates,lambda t: (t[0],t[1]))
	center=method2.kmeans([(coordinates[0][0],coordinates[0][1])],coordinates)

	propertytemp= method2.select(propertydata, lambda t: t["gross_tax"]!=0)
	propertydistancetemp= method2.project(propertytemp,lambda t: {"id":t["_id"],"address":t["full_address"],"distance":0,"coordinates":t["location"],"tax":int(t["gross_tax"])})
	propertydistancetemp1= method2.project(propertydistancetemp,lambda t: method2.stringprocess1(t))
	propertydistancetemp2= method2.project(propertydistancetemp1,lambda t: method2.stringprocess2(t))

	propertycoor=inrange1(smallx,bigx,smally,bigy,propertydistancetemp2)

	propertydistance= method2.distance_to_mean1(center,propertycoor)

	tax= method2.project(propertydistance,lambda t: t["tax"])
	distance= method2.project(propertydistance,lambda t: t["distance"])

	correlation= method2.corr(tax,distance)

	return str(correlation)


def inrange(smallx,bigx,smally,bigy,c):
	l=[]
	for i in c:
		if i[0]<smallx:
			continue
		elif i[0]>bigx:
			continue
		elif i[1]<smally:
			continue
		elif i[1]>bigy:
			continue
		else:
			l.append(i)
	return l

def inrange1(smallx,bigx,smally,bigy,R):
	l=[]
	for i in R:
		if i["coordinates"][0]<smallx:
			continue
		elif i["coordinates"][0]>bigx:
			continue
		elif i["coordinates"][1]<smally:
			continue
		elif i["coordinates"][1]>bigy:
			continue
		else:
			l.append(i)
	return l


if __name__ == '__main__':
	app.run(debug=True)











































