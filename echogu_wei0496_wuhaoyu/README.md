# Boston Public School Transportation Challenge<br>School Bus Routing System Optimizations
Team: [Lingyi Gu](https://github.com/lingyigu), [Wei Wei](https://github.com/wei0496), [Haoyu(Jerry) Wu](https://github.com/wuhaoyujerry)

## Objective
In 2016, transportation costs accounted for for $110 million. Among them, Boston Public School’s transportation cost is the #2 highest. The [Boston Public Schools](http://www.bostonpublicschools.org/) has announced a [Transportation Challenge](http://bostonpublicschools.org/transportationchallenge). Our team utilizes the data mechanics techniques to solve this challenge and contributes to Step 2 of the Routing Challenge, which aims to improve the school bus routing efficiency. Specifically, our objectives include:
* Address the inefficiencies and rising costs in current transportation system
* Improve the school bus routing efficiency to decrease students riding time
* Reduce operational cost by systemically allocating resources

## Algorithm Overview
![algorithm-overview](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/algorithm-overview.png)

## Data Retrieval, Storage, Provenance, and Transformations
list the data sets you used or other online resources you collected or retrieved automatically, and their origins, and
describe any data sets you assembled manually or programmatically using the above;

## Modeling and Optimization
### Assumptions
Consider the project deadline and our capability, we made a few assumptions for the sake of simplicity:
1. Students are picked up from their home location.
2. The bell time are ignored.
3. Each bus has unlimited capacity.
4. The bus route is planned  based on the Euclidean distance between coordinates rather than the actual distance by driving.

### Assigning Students to Buses
We retrieve the students’ coordinates and schools they attend from the data set and aggregate by school names.
##### Number of buses
We set each school bus to have 50 seats, which is same as a normal bus size.  Therefore, we have a general idea of how many buses we need for each school.
##### K-means Clustering Algorithm
In order to make sure each bus has shortest route, it needs to pick students that live near to each other. Therefore, we implement the [k-mean clustering](https://en.wikipedia.org/wiki/K-means_clustering)  algorithm to group the students based on their location. Then we find the student points in each cluster and store them into the new data set ```assigned_students```. Because we cannot control how many students are assigned into each cluster, we cannot  guarantee that each bus have less than 50 students.

### Optimize Pick-up Sequence
We use the new data obtained from the previous algorithm.
##### Minimum Spanning Tree
We implement the [Minimum Spanning Tree](https://en.wikipedia.org/wiki/Minimum_spanning_tree) algorithm to find the relatively minimum distance for each bus to pick all the students in that cluster. The algorithm outputs a pickup sequence for each school bus. For each mean point found in the previous algorithm, we store the pickup sequence with the student's ID (generated by MongoDB) and pick up location into the data set ```bus_route```.
We have not assigned a bus yard to each mean point yet, but it can be done by finding the closest bus yard to each mean.

##### Issue with MST
Although MST returns the minimum weight of the tree, the issue regarding it is that
the bus would go "there and back" for every subtree. This may lead to redundant traveling route.

#### Dynamic Programming
We also implement the dynamic programming (DP) approach to find the shortest path among all the permutation of all the possible pick up sequences.

##### Issue with DP
Although DP yields the optimal result, its running time is too high and grows exponentially as the bus capacity increases. Due to the exponential running time, we did not choose DP approach in the end.

#### Greedy Algorithm (Nearest Neighbor Heuristic)
The algorithm randomly selects the starting point and consistently chooses the nearest students as the next stop. This algorithm is the optimal solution for our project because it yields shorter routes than Prim's algorithm and lower running time than DP.

#### Assigning Bus Yard to Each Route
This is a very straightforward problem. Since there's only a few bus yards, we simply apply a brute force algorithm to find its closest bus yard to either the first stop or last stop of the route and assign the bus yard to the route.

#### Limitations and Future Work
1. K-means algorithm can't guarantee that the number of students assigned to each cluster is equal.
2. Incorporate the real road information of the map and expend the current solution by using Dijkstra algorithm instead of Euclidean distance.
3. Creating gathering points for nearby students to further reduce bus stops and the bus traveling distance.

## Visualizations and Web Services
#### Visualization
We have created a web-based interactive map for the generated bus routes using [Leaflet](http://leafletjs.com/). Users can see the detailed information of each route, school and yard by clicking on the grey line, green dot and purple dot respectively.

![visualization-all](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/visualization-all.png "Display Bus Routes")

![visualization-route-info](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/vvisualization-route-info.png "Display Route Information")

![visualization-school-info](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/vvisualization-school-info.png "Display School Information")

![visualization-yard-info](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/visualization-yard-info.png "Display Yard Information")

#### Web Service
Based on the map, we have also provided a web service where users can choose a school from the drop down menu and visualize an individual school's bus routes. This is created using [Flask](http://flask.pocoo.org/) with [Jinja 2](http://jinja.pocoo.org/docs/2.9/).

![web-pick-school](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/web-pick-school.png "Picking A School")

![web-one-school](https://github.com/lingyigu/course-2017-spr-proj/blob/master/echogu_wei0496_wuhaoyu/visualizations/img/web-one-school.png "Display An Individual School's Routes")

#### Usage
To run the web service in the ```echogu_wei0496_wuhaoyu/visualizations``` directory:
```
export FLASK_APP=app.py
flask run
```
To Open in the browser:
```
http://localhost:5000/
```

## Reference
[1] K-Means Clustering Algorithm. **"Data Mechanics"**.<br> [http://cs-people.bu.edu/lapets/591/s.php#2.2](http://cs-people.bu.edu/lapets/591/s.php#2.2)<br>
[2] Basic greedy TSP solver in Python. **"dmishin/tsp-solver: Travelling Salesman Problem solver in pure Python + some visualizers"**. [https://github.com/dmishin/tsp-solver](https://github.com/dmishin/tsp-solver)

## Installation
To set up MongoDB, follow the procedure in [Data-Mechanics/course-2017-spr-proj](https://github.com/Data-Mechanics/course-2017-spr-proj).

To install all dependencies:
```
python3 -m pip install --upgrade --no-cache-dir -r requirements.txt
```
To execute the script:
```
python3 execute.py echogu_wei0496_wuhaoyu
```
To execute the script in trial mode:
```
python3 execute.py echogu_wei0496_wuhaoyu --trial
```
